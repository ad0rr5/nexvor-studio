
import React, { useState, useEffect, useRef } from 'react';
import { createRoot } from 'react-dom/client';

type Theme = 'light' | 'dark';
type Page = 'home' | 'games' | 'tools' | 'about';

// Ikonlar (SVG)
const SunIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
  </svg>
);

const MoonIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
  </svg>
);

const MenuIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
);

const CloseIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
);


// Tema DeÄŸiÅŸtirici Butonu BileÅŸeni
const ThemeSwitcher = ({ theme, toggleTheme }: { theme: Theme, toggleTheme: () => void }) => {
  return (
    <button className="theme-switcher" onClick={toggleTheme} aria-label={`Activate ${theme === 'light' ? 'dark' : 'light'} mode`}>
      {theme === 'light' ? <MoonIcon /> : <SunIcon />}
    </button>
  );
};

// Header BileÅŸeni
const Header = ({ theme, toggleTheme, page, setPage }: { theme: Theme, toggleTheme: () => void, page: Page, setPage: (page: Page) => void }) => {
  const [menuOpen, setMenuOpen] = useState(false);

  const toggleMenu = () => {
    setMenuOpen(!menuOpen);
  };

  const handleNavClick = (targetPage: Page) => {
    setPage(targetPage);
    setMenuOpen(false);
  }

  useEffect(() => {
    if (menuOpen) {
      document.body.classList.add('no-scroll');
    } else {
      document.body.classList.remove('no-scroll');
    }
  }, [menuOpen]);

  return (
    <header className="app-header">
      <div className="container header-content">
        <div className="logo">
          <a href="#" onClick={(e) => { e.preventDefault(); handleNavClick('home'); }}>Nexvor Studio</a>
        </div>
        <nav className={menuOpen ? 'open' : ''}>
          <ul>
            <li><button onClick={() => handleNavClick('home')} className={page === 'home' ? 'active' : ''}>Ana Sayfa</button></li>
            <li><button onClick={() => handleNavClick('games')} className={page === 'games' ? 'active' : ''}>Oyunlar</button></li>
            <li><button onClick={() => handleNavClick('tools')} className={page === 'tools' ? 'active' : ''}>AraÃ§lar</button></li>
            <li><button onClick={() => handleNavClick('about')} className={page === 'about' ? 'active' : ''}>HakkÄ±mÄ±zda</button></li>
            <li><ThemeSwitcher theme={theme} toggleTheme={toggleTheme} /></li>
          </ul>
        </nav>
        <div className="mobile-menu-toggle" onClick={toggleMenu} aria-label="Toggle menu">
            {menuOpen ? <CloseIcon /> : <MenuIcon />}
        </div>
      </div>
    </header>
  );
};


// Intersection Observer Hook'u
const useIntersectionObserver = (options: IntersectionObserverInit) => {
    const containerRef = useRef<HTMLDivElement>(null);
    const [isVisible, setIsVisible] = useState(false);

    useEffect(() => {
        const observer = new IntersectionObserver(([entry]) => {
            if (entry.isIntersecting) {
                setIsVisible(true);
                observer.unobserve(entry.target);
            }
        }, options);

        const currentRef = containerRef.current;
        if (currentRef) {
            observer.observe(currentRef);
        }

        return () => {
            if (currentRef) {
                observer.unobserve(currentRef);
            }
        };
    }, [containerRef, options]);

    return [containerRef, isVisible] as const;
};

// Animasyonlu BÃ¶lÃ¼m BileÅŸeni
const AnimatedSection = ({ children, className = '' }: { children: React.ReactNode, className?: string }) => {
    const [ref, isVisible] = useIntersectionObserver({ threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    return (
        <div ref={ref} className={`section-fade-in ${isVisible ? 'visible' : ''} ${className}`}>
            {children}
        </div>
    );
};


// Hero BileÅŸeni
const Hero = ({ setPage }: { setPage: (page: Page) => void }) => {
    return (
        <section id="home" className="hero-section">
            <div className="container hero-content">
                <AnimatedSection>
                    <h1 className="hero-title">Gelecek Burada BaÅŸlÄ±yor</h1>
                    <p className="hero-subtitle">YaratÄ±cÄ± oyunlar ve kullanÄ±ÅŸlÄ± araÃ§larla fikirlerinizi hayata geÃ§iriyoruz.</p>
                    <button onClick={() => setPage('games')} className="cta-button">Projeleri KeÅŸfet</button>
                </AnimatedSection>
            </div>
             <div className="hero-bg"></div>
        </section>
    );
};

// Proje Detay ModalÄ± - GeliÅŸmiÅŸ Animasyonlarla
const ProjectDetailModal = ({ project, isOpen, onClose }: { 
  project: Project | null, 
  isOpen: boolean, 
  onClose: () => void 
}) => {
  const [isClosing, setIsClosing] = useState(false);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    if (isOpen) {
      setMounted(true);
      setIsClosing(false);
      // Body scroll'u engelle
      document.body.style.overflow = 'hidden';
    } else {
      // Body scroll'u geri getir
      document.body.style.overflow = 'unset';
    }

    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [isOpen]);

  const handleClose = () => {
    setIsClosing(true);
    // Animasyon bitene kadar bekle
    setTimeout(() => {
      setMounted(false);
      setIsClosing(false);
      onClose();
    }, 300);
  };

  // ESC tuÅŸu ile kapanma
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && isOpen) {
        handleClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
    };
  }, [isOpen]);

  if (!mounted || !project) return null;

  return (
    <div 
      className={`modal-overlay ${isClosing ? 'closing' : ''}`} 
      onClick={handleClose}
      style={{ 
        pointerEvents: isClosing ? 'none' : 'auto'
      }}
    >
      <div 
        className="modal-content" 
        onClick={(e) => e.stopPropagation()}
        role="dialog"
        aria-labelledby="modal-title"
        aria-describedby="modal-description"
      >
        <button 
          className="modal-close" 
          onClick={handleClose}
          aria-label="ModalÄ± kapat"
        >
          Ã—
        </button>
        
        <div className="modal-header">
          <div className="modal-icon" aria-hidden="true">
            {project.icon}
          </div>
          <h2 id="modal-title">{project.title}</h2>
        </div>
        
        <div className="modal-body">
          <p id="modal-description" className="modal-description">
            {project.detailedDescription || project.description}
          </p>
          
          {project.features && project.features.length > 0 && (
            <div className="modal-features">
              <h3>Ã–zellikler:</h3>
              <ul>
                {project.features.map((feature, index) => (
                  <li key={index} style={{ animationDelay: `${0.7 + index * 0.1}s` }}>
                    {feature}
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
        
        <div className="modal-footer">
          {project.link && (
            <a 
              href={project.link} 
              target="_blank" 
              rel="noopener noreferrer" 
              className="modal-link-btn"
              onClick={(e) => {
                // Link tÄ±klandÄ±ÄŸÄ±nda modal kapanmasÄ±n
                e.stopPropagation();
              }}
            >
              ğŸš€ Projeyi GÃ¶rÃ¼ntÃ¼le
            </a>
          )}
        </div>
      </div>
    </div>
  );
};

// Proje KartÄ± BileÅŸeni
interface Project {
    id: number;
    title: string;
    description: string;
    icon: string;
    featured: boolean;
    detailedDescription?: string;
    features?: string[];
    link?: string;
}

const ProjectCard = ({ project, onClick }: { project: Project, onClick: () => void }) => {
    return (
        <div className="project-card">
            <div className="project-card-icon">{project.icon}</div>
            <h3 className="project-card-title">{project.title}</h3>
            <p className="project-card-description">{project.description}</p>
            <button onClick={onClick} className="project-card-link">Daha Fazla Bilgi &rarr;</button>
        </div>
    );
};


// Ã–ne Ã‡Ä±kanlar BÃ¶lÃ¼mÃ¼
const FeaturedSection = ({ id, title, projects, onProjectClick }: { 
  id: string, 
  title: string, 
  projects: Project[], 
  onProjectClick: (project: Project) => void 
}) => {
    return (
        <section id={id} className="featured-section">
            <div className="container">
                <AnimatedSection>
                    <h2 className="section-title">{title}</h2>
                    <div className="project-grid">
                        {projects.map((project) => (
                           <AnimatedSection key={project.id}>
                             <ProjectCard 
                               project={project} 
                               onClick={() => onProjectClick(project)}
                             />
                           </AnimatedSection>
                        ))}
                    </div>
                </AnimatedSection>
            </div>
        </section>
    );
};


// HakkÄ±mÄ±zda BÃ¶lÃ¼mÃ¼ (Ana Sayfa iÃ§in)
const AboutSection = ({ setPage }: { setPage: (page: Page) => void }) => {
    return (
        <section id="about" className="about-section">
            <div className="container">
                <AnimatedSection>
                    <h2 className="section-title">Biz Kimiz?</h2>
                    <p className="about-text">
                        2025 yÄ±lÄ±nda henÃ¼z lise Ã§aÄŸÄ±nda olan 4 genÃ§ giriÅŸimci tarafÄ±ndan kurulan Nexvor Studio, teknolojiye olan tutkuyla doÄŸdu. YaÅŸÄ±mÄ±z kÃ¼Ã§Ã¼k ama hayallerimiz bÃ¼yÃ¼k! Oyun geliÅŸtirme ve pratik dijital Ã§Ã¶zÃ¼mler Ã¼retme konusundaki kararlÄ±lÄ±ÄŸÄ±mÄ±zla, geleceÄŸin teknoloji dÃ¼nyasÄ±nda iz bÄ±rakmayÄ± hedefliyoruz.
                    </p>
                    <button onClick={() => setPage('about')} className="cta-button secondary">Hikayemizin DevamÄ±</button>
                </AnimatedSection>
            </div>
        </section>
    )
}

// Footer BileÅŸeni
const Footer = () => {
  return (
    <footer className="app-footer">
      <div className="container footer-content">
        <p>&copy; {new Date().getFullYear()} Nexvor Studio. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        <div className="social-links">
          {/* Gelecekte sosyal medya ikonlarÄ± buraya eklenecek */}
          <a href="#" aria-label="Twitter">T</a>
          <a href="#" aria-label="Discord">D</a>
          <a href="#" aria-label="Instagram">I</a>
        </div>
      </div>
    </footer>
  );
};

// JSON dosyalarÄ±ndan verileri yÃ¼klemek iÃ§in utility fonksiyonlarÄ±
const loadJSONData = async (path: string): Promise<Project[]> => {
  try {
    const response = await fetch(path);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error(`Error loading data from ${path}:`, error);
    return [];
  }
};

// Custom hook for data loading
const useProjectData = () => {
  const [games, setGames] = useState<Project[]>([]);
  const [tools, setTools] = useState<Project[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadData = async () => {
      try {
        setLoading(true);
        setError(null);
        
        const [gamesData, toolsData] = await Promise.all([
          loadJSONData('./data/games.json'),
          loadJSONData('./data/tools.json')
        ]);
        
        setGames(gamesData);
        setTools(toolsData);
      } catch (err) {
        console.error('Error loading project data:', err);
        setError('Veri yÃ¼klenirken bir hata oluÅŸtu');
      } finally {
        setLoading(false);
      }
    };

    loadData();
  }, []);

  return { games, tools, loading, error };
};

// Loading BileÅŸeni
const LoadingSpinner = () => (
  <div className="loading-container" style={{ 
    display: 'flex', 
    justifyContent: 'center', 
    alignItems: 'center', 
    minHeight: '200px',
    fontSize: '18px',
    color: 'var(--text-secondary)'
  }}>
    <div>ğŸ“¡ Veriler yÃ¼kleniyor...</div>
  </div>
);

// Error BileÅŸeni
const ErrorMessage = ({ message }: { message: string }) => (
  <div className="error-container" style={{ 
    display: 'flex', 
    justifyContent: 'center', 
    alignItems: 'center', 
    minHeight: '200px',
    fontSize: '18px',
    color: 'var(--accent-color)',
    textAlign: 'center'
  }}>
    <div>âš ï¸ {message}</div>
  </div>
);

// Sayfa BileÅŸenleri
const HomePage = ({ setPage, onProjectClick }: { 
  setPage: (page: Page) => void,
  onProjectClick: (project: Project) => void 
}) => {
    const { games, tools, loading, error } = useProjectData();
    
    if (loading) {
        return (
            <>
                <Hero setPage={setPage} />
                <LoadingSpinner />
            </>
        );
    }
    
    if (error) {
        return (
            <>
                <Hero setPage={setPage} />
                <ErrorMessage message={error} />
            </>
        );
    }
    
    const featuredGames = games.filter(game => game.featured);
    const featuredTools = tools.filter(tool => tool.featured);
    
    return (
        <>
            <Hero setPage={setPage} />
            <FeaturedSection 
              id="games" 
              title="PopÃ¼ler Oyunlar" 
              projects={featuredGames} 
              onProjectClick={onProjectClick}
            />
            <FeaturedSection 
              id="tools" 
              title="PopÃ¼ler AraÃ§lar" 
              projects={featuredTools} 
              onProjectClick={onProjectClick}
            />
            <AboutSection setPage={setPage} />
        </>
    );
};

const AllProjectsPage = ({ title, projects, onProjectClick, loading, error }: { 
  title: string, 
  projects: Project[], 
  onProjectClick: (project: Project) => void,
  loading?: boolean,
  error?: string | null
}) => {
    if (loading) {
        return (
            <section className="page-container">
                <div className="container">
                    <h2 className="section-title">{title}</h2>
                    <LoadingSpinner />
                </div>
            </section>
        );
    }
    
    if (error) {
        return (
            <section className="page-container">
                <div className="container">
                    <h2 className="section-title">{title}</h2>
                    <ErrorMessage message={error} />
                </div>
            </section>
        );
    }
    
    return (
        <section className="page-container">
            <div className="container">
                <AnimatedSection>
                    <h2 className="section-title">{title}</h2>
                    <div className="project-grid">
                        {projects.map((project) => (
                           <AnimatedSection key={project.id}>
                             <ProjectCard 
                               project={project} 
                               onClick={() => onProjectClick(project)}
                             />
                           </AnimatedSection>
                        ))}
                    </div>
                </AnimatedSection>
            </div>
        </section>
    );
};

const AboutPage = () => {
    return (
        <section className="page-container about-page">
            <div className="container">
                <AnimatedSection>
                    <h2 className="section-title">HakkÄ±mÄ±zda</h2>
                    <div className="about-page-content">
                        <p>
                            <strong>Nexvor Studio, 2025 yÄ±lÄ±nda henÃ¼z lise Ã§aÄŸÄ±nda olan 4 genÃ§ giriÅŸimci tarafÄ±ndan kuruldu.</strong> Dersler arasÄ±nda kodlama Ã¶ÄŸrenen, okuldan sonra oyun geliÅŸtirme projelerinde Ã§alÄ±ÅŸan ve geleceÄŸin teknolojilerini bugÃ¼nden keÅŸfetmeye kararlÄ± dÃ¶rt arkadaÅŸÄ±z. YaÅŸÄ±mÄ±z kÃ¼Ã§Ã¼k olabilir ama hayallerimiz ve hedeflerimiz bÃ¼yÃ¼k!
                        </p>
                        <p>
                            Teknolojiye olan tutkumuz bizi bir araya getirdi. Her birimiz farklÄ± yeteneklere sahipken - kimisi kodlamada, kimisi tasarÄ±mda, kimisi proje yÃ¶netiminde parlÄ±yor - ortak amacÄ±mÄ±z insanlarÄ±n hayatÄ±nÄ± kolaylaÅŸtÄ±ran ve eÄŸlendiren dijital Ã¼rÃ¼nler yaratmak. Lise hayatÄ±mÄ±z ve Ã¶ÄŸrenme sÃ¼recimiz devam ederken, boÅŸ zamanlarÄ±mÄ±zÄ± bu stÃ¼dyoyu bÃ¼yÃ¼tmeye adÄ±yoruz.
                        </p>
                        <p>
                           Nexvor Studio olarak, genÃ§ bakÄ±ÅŸ aÃ§Ä±mÄ±zla sektÃ¶re yenilikÃ§i Ã§Ã¶zÃ¼mler getirmeyi, yaÅŸÄ±tlarÄ±mÄ±za ilham vermeyi ve teknoloji dÃ¼nyasÄ±nda iz bÄ±rakmayÄ± hedefliyoruz. Her proje bizim iÃ§in bir Ã¶ÄŸrenme deneyimi ve geleceÄŸe atÄ±lan bir adÄ±m. Ã‡Ã¼nkÃ¼ biz, geleceÄŸin teknoloji liderleriyiz! ğŸš€
                        </p>
                    </div>
                </AnimatedSection>
            </div>
        </section>
    );
};


// Ana Uygulama BileÅŸeni
const App = () => {
  // Tema state'ini yÃ¶net
  const [theme, setTheme] = useState<Theme>(() => {
    const storedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    return (storedTheme as Theme) || (systemPrefersDark ? 'dark' : 'light');
  });

  const [page, setPage] = useState<Page>('home');
  const [selectedProject, setSelectedProject] = useState<Project | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  
  // Data loading
  const { games, tools, loading, error } = useProjectData();

  // Tema deÄŸiÅŸtiÄŸinde DOM'a ve localStorage'a yansÄ±t
  useEffect(() => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);
  
  // Sayfa deÄŸiÅŸtiÄŸinde en Ã¼ste scroll yap
  useEffect(() => {
    window.scrollTo(0, 0);
  }, [page]);

  const toggleTheme = () => {
    setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
  };

  const handleProjectClick = (project: Project) => {
    setSelectedProject(project);
    setIsModalOpen(true);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setSelectedProject(null);
  };

  const renderPage = () => {
      switch (page) {
          case 'games':
              return <AllProjectsPage 
                title="TÃ¼m Oyunlar" 
                projects={games} 
                onProjectClick={handleProjectClick}
                loading={loading}
                error={error}
              />;
          case 'tools':
              return <AllProjectsPage 
                title="TÃ¼m AraÃ§lar" 
                projects={tools} 
                onProjectClick={handleProjectClick}
                loading={loading}
                error={error}
              />;
          case 'about':
              return <AboutPage />;
          case 'home':
          default:
              return <HomePage 
                setPage={setPage} 
                onProjectClick={handleProjectClick}
              />;
      }
  }

  return (
    <>
      <Header theme={theme} toggleTheme={toggleTheme} page={page} setPage={setPage} />
      <main>
          {renderPage()}
      </main>
      <Footer />
      <ProjectDetailModal 
        project={selectedProject} 
        isOpen={isModalOpen} 
        onClose={closeModal} 
      />
    </>
  );
};

// React uygulamasÄ±nÄ± DOM'a render et
const container = document.getElementById('root');
if (container) {
  const root = createRoot(container);
  root.render(<App />);
}
